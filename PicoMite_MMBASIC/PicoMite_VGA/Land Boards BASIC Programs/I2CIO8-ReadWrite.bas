' Test I2CIO-8 card
' Read  4 jumpers, write out to 4 LEDs
' Move jumper to see LED move
'
' Address set to H21
' GPIO0-3 = LEDs = OUT
' GPIO4-7 = Jumpers = IN
'
' LAND BOARDS, 2022
'

MCP23008_I2CADR  = &H21
MCP23008_IODIR   = &H00
MCP23008_IPOL    = &H01
MCP23008_GPINTEN = &H02
MCP23008_DEFVAL  = &H03
MCP23008_INTCON  = &H04
MCP23008_IOCON   = &H05
MCP23008_GPPU    = &H06
MCP23008_INTF    = &H07
MCP23008_INTCAP  = &H08
MCP23008_GPIO    = &H09
MCP23008_OLAT    = &H0A

Dim BUF(2):'Allocate receive buffer space
Print "Lopp Jumpers to LEDs (I2CIO8-02.bas)"
Print "Hit a key to exit"

' Setup MCP23017 registers
SetPin GP14, GP15, I2C2:'Uses I2C2 (I2C1 on part)
I2C2 OPEN 400, 100:'400KHz, 100 mS timeout
I2C2 WRITE MCP23008_I2CADR, 0, 2, MCP23008_IODIR, &HF0
I2C2 WRITE MCP23008_I2CADR, 0, 2, MCP23008_IPOL, &HF0
I2C2 WRITE MCP23008_I2CADR, 0, 2, MCP23008_IOCON, &H42

' Do the loop, CTRL-C to exit

LoopBack:
' Read Jumpers
I2C2 WRITE MCP23008_I2CADR, 1, 1, MCP23008_GPIO
I2C2 READ MCP23008_I2CADR, 0, 1, BUF()
ODat=(BUF(0)And 240 ) / 16
' Write out to LEDs
I2C2 WRITE MCP23008_I2CADR, 0, 2, MCP23008_OLAT, ODat
If Inkey$ <> "" GoTo Done
GoTo LoopBack
Done:
